function MyDemoApplication(options){
  // Apply super constructor
  DemoApplication.apply(this,arguments);
}

// Extend prototype methods
$.extend(MyDemoApplication.prototype,
	 DemoApplication.prototype);

MyDemoApplication.prototype.initPhysics = function(){
  // Bullet-interfacing code
  var collisionConfiguration = new Ammo.btDefaultCollisionConfiguration();
  var dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration);
  var overlappingPairCache = new Ammo.btDbvtBroadphase();
  //var overlappingPairCache = new Ammo.btAxisSweep3(new Ammo.btVector3(-10,-10,-10),new Ammo.btVector3(10,10,10));

  var solver = new Ammo.btSequentialImpulseConstraintSolver();
  this.m_dynamicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguration);
  this.m_dynamicsWorld.setGravity(this.tVec(0, -9.82, 0));

  // Create bodies
  var boxShape1 = new Ammo.btBoxShape(this.tVec(0.2, 1, 0.2));
  var boxTrans1 = new Ammo.btTransform();
  boxTrans1.setIdentity();
  boxTrans1.setOrigin(this.tVec(0, 3.0, 1));
  var box1 = this.localCreateRigidBody(1, boxTrans1, boxShape1);
  var boxShape2 = new Ammo.btBoxShape(this.tVec(0.2, 1, 0.2));
  var boxTrans2 = new Ammo.btTransform();
  boxTrans2.setIdentity();
  boxTrans2.setOrigin(this.tVec(1, 5.0, 1));
  var box2 = this.localCreateRigidBody(1, boxTrans2, boxShape2);

  // http://bulletphysics.org/Bullet/phpBB3/viewtopic.php?f=9&t=3191

  // 1st constructor
  var hinge1 = new Ammo.btHingeConstraint(box1,
					  box2,
					  new Ammo.btVector3(0,1,0),
					  new Ammo.btVector3(0,-1,0),
					  new Ammo.btVector3(0,0,1),
					  new Ammo.btVector3(0,0,1),
					  false);
  // 2nd constructor
  var hinge2 = new Ammo.btHingeConstraint(box2,
					  new Ammo.btVector3(0,1,0),
					  new Ammo.btVector3(0,0,1),
					  false);
  this.m_dynamicsWorld.addConstraint(hinge1, true);
  this.m_dynamicsWorld.addConstraint(hinge2, true);



  // --- Using frames ---
  // Create bodies
  var boxShape3 = new Ammo.btBoxShape(this.tVec(0.2, 1, 0.2));
  var boxTrans3 = new Ammo.btTransform();
  boxTrans3.setIdentity();
  boxTrans3.setOrigin(this.tVec(0, 3.0, 0));
  var box3 = this.localCreateRigidBody(1, boxTrans3, boxShape3);
  //var boxShape4 = new Ammo.btBoxShape(this.tVec(0.2, 1, 0.2));
  //var boxTrans4 = new Ammo.btTransform();
  //boxTrans4.setIdentity();
  //boxTrans4.setOrigin(this.tVec(0, 5.0, -1));
  //var box4 = this.localCreateRigidBody(1, boxTrans4, boxShape4);

  var localA = new Ammo.btTransform();
  //var localB = new Ammo.btTransform();
  localA.setIdentity();
  //localB.setIdentity();
  /*
  localA.getBasis().setEulerZYX(0,Math.PI/2,0);
  localA.setOrigin(new Ammo.btVector3((0), (0.1), (0.)));
  localB.getBasis().setEulerZYX(0,Math.PI/2,0);
  localB.setOrigin(new Ammo.btVector3((0.), (-0.1), (0.)));
  */
  var ctWorldTransform = new Ammo.btTransform();
  ctWorldTransform.setIdentity();
  ctWorldTransform.setOrigin(new Ammo.btVector3(0,4,0));
  ctWorldTransform.setRotation(new Ammo.btQuaternion(1,0,0,0));
  var res = (box3.getCenterOfMassTransform().inverse());
  var localA = res.op_mul(ctWorldTransform);
  
  console.log(res);
  console.log("Times");
  console.log(ctWorldTransform);
  console.log("=");
  console.log(localA);
  //var localB = box4.getCenterOfMassTransform().inverse().op_mul(ctWorldTransform);
  /*
  //localA.getBasis().setEulerZYX(0,0,0);
  localA.setOrigin(new Ammo.btVector3(0, 2, 0));
  */

  var hinge3 = new Ammo.btHingeConstraint(box3,localA,false);
  this.m_dynamicsWorld.addConstraint(hinge3, true);
  //this.m_dynamicsWorld.addConstraint(hinge4, true);


    
  // Create ground
  var groundShape = new Ammo.btBoxShape(this.tVec(6, 0.5, 6));
  var groundTransform = new Ammo.btTransform();
  groundTransform.setIdentity();
  groundTransform.setOrigin(this.tVec(0, -1.0, 0));
  var ground = this.localCreateRigidBody(0, groundTransform, groundShape);

  // Create infinite ground plane
  var aabbShape = new Ammo.btStaticPlaneShape(this.tVec(0, 1, 0), -50);
  var aabbTransform = new Ammo.btTransform();
  aabbTransform.setIdentity();
  this.localCreateRigidBody(0, aabbTransform, aabbShape);

  // Set keyboard actions
  var th = this;
  this.keyboardCallback({e:function(e,da){
	console.log("Pressed e");
	var r = new RagDoll(th,th.tVec(0,0,0));
      }
    });

  // Reset scene
  this.clientResetScene();
};

MyDemoApplication.prototype.clientMoveAndDisplay = function(){
  // Simple dynamics world doesn't handle fixed-time-stepping
  var ms = this.getDeltaTimeMicroseconds();
  var minFPS = 1000000.0/60.0;
  if(ms > minFPS)
    ms = minFPS;
  
  if(this.m_dynamicsWorld)
    this.m_dynamicsWorld.stepSimulation(ms / 1000000.0);
};
